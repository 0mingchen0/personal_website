---
title: "Life Expectancy Analysis and Prediction"
author: Mingchen Wang
toc: false
date: "03-08-2024"
description: A project that intends to investigate how various variables in different nations affect oneâ€™s life expectancy. Using various modeling and prediction techniques in R and SQL, this project answers a simple question -- what makes you live longer?
image: "https://media.istockphoto.com/id/1413583709/photo/cheerful-senior-having-fun-while-taking-selfie-at-retirement-community.jpg?s=612x612&w=0&k=20&c=nYFvWrL80Zh9DCDbBJNO5DnUQQv9qliQfBjLfFcymCc="
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyr)
library(GGally) 
library(gridExtra)
library(car)
library(ggplot2)
```

# Introduction

## Background

An essential measure of a country's health and prosperity is its life expectancy. Many would argue that this is influenced by a number of variables, including lifestyle choices, social influences, genetics, and access to healthcare. There are still a lot of differences in life expectancy between nations and areas, with some populations having substantially lower life expectancy than others. But why? This project intends to investigate how various variables in different nations affect one's life expectancy. Or, in a broad sense, what makes you live longer?

The values used in this project is sourced from the data set [**Life Expectancy**](https://www.kaggle.com/datasets/vrec99/life-expectancy-2000-2015) (hyperlink included) from Kaggle. This data set contains information about life expectancy for people, CO2 emissions and Health expenditure, Obesity rate, and people using at least basic drinking water services across the world (contains 1904 unique values)

## Modeling and Structure

A linear model will be made based on Life Expectancy and other factors, where the average life expectancy in a country will be our response variable. Our model will be adjusted to fit, we will determine which variables effects one's life expectancy, and make adjustments based on our calculations. 

This report will be divided into five sections:

-   The current introduction section

-   Data Description, some basic summary and cleaning process of the data.

-   Modeling, analyzation, and interpretation of the data

-   A summary of results.

-   A discussion of my findings

# Data Description.

## Data cleaning:

In order to see the variables we wanted in one data set, let's first load our data, then remove all the terms that is not necessary for this study.

```{r}
Life_expectancy_old <- read.csv(file = "Life_Expectancy_00_15.csv", head = TRUE, sep=";")


LifeExp <- Life_expectancy_old %>% 
  filter (Year == "2015") %>%  # for the purpose of this study,
  # let's only look at one specific year.
  select("Life.Expectancy", "CO2.emissions", 
         "Health.expenditure", "Electric.power.consumption", 
         "People.using.at.least.basic.drinking.water.services",
         "Beer.consumption.per.capita",
         "Obesity.among.adults") %>% 
  rename("DrinkableWater"
         = "People.using.at.least.basic.drinking.water.services",
         "ElectricPower" = "Electric.power.consumption",
          "Beer" = "Beer.consumption.per.capita",
          "Obesity" = "Obesity.among.adults")
  #for the sake of making our summary table shorter, let's rename our column values 

head(LifeExp)
```

## Summary

Now we have our data set in hand, let's check out some summary statistics.

```{r}
summary(LifeExp)
```
It seems like the lowest average Life Expectancy in a country is about 53 years, while the highest is almost 83 years. This data is consisitent with our currernt understanding of life expectancy. 
We are also able to see some summary statistics about other factors such as CO2 emission rates and electric power consumption in the chart above as well. 

# Modeling and Analyzation

## Modeling

We are interested in developing model for Life Expectancy (Life.Expectancy) based on our predictors. (CO2.emissions, Health.expenditure, ElectricPower, DrinkableWater, Beer, Obesity)

Let's first take a look a the scatter plots between Life Expectancy and possible predictor variables listed.

```{r}
plot1 <- ggplot(LifeExp, aes(x=Life.Expectancy, y=CO2.emissions)) + 
    geom_point()
plot2 <- ggplot(LifeExp, aes(x=Life.Expectancy, y=Health.expenditure)) + geom_point()
plot3 <- ggplot(LifeExp, aes(x=Life.Expectancy, y=ElectricPower)) + 
    geom_point()
plot4 <- ggplot(LifeExp, aes(x=Life.Expectancy, y=DrinkableWater)) + 
    geom_point()
plot5 <- ggplot(LifeExp, aes(x=Life.Expectancy, y=Beer)) + 
    geom_point()
plot6 <- ggplot(LifeExp, aes(x=Life.Expectancy, y=Obesity)) + 
    geom_point()

grid.arrange(plot1, plot2, plot3, plot4, plot5, plot6, ncol=3)

```

All the predictor variables seems to have at least some amount of correlation to Life Expectancy. There are no graphs that seems significantly concerning, or have absolutely no correlation here.

We can also create a scatter plot matrix between the variables to see the relationship between each of the variables, and to check if there are any predictors that are correlated to each other.

```{r}
ggpairs(LifeExp[,2:7])
```

As seen in the plot, there is a high correlation between electric power consumption and CO2 emission. The correlation value of 0.799 further proves this point, the closer this value is to one, the higher the correlation is. This values makes sense in a real world context as well, since we know that electric power is often tied to energy production, and is seen as one of the source of greenhouse gas emission.(Here is a study by United States Environmental Protection Agency, where it is found that about 25% of Greenhouse Gas Emissions is caused by electric power consumption: [https://www.epa.gov/ghgemissions/sources-greenhouse-gas-emissions])

People using at least basic drinking water services and Adult Obesity rate as seem to have a high correlation, with a correlation value of 0.726. Putting this into real world context, it is true that drinking unfiltered water could cause many diseases, some of which could have the effect of weight gaining. (Here is a study  about contamination in water and obesity for reference: [https://www.sciencedirect.com/science/article/pii/S0160412020322571]) 

The separate relationships between the response variable and each of the predictor variables do not appear to be linear. Let's try to build a linear model based on these predictor variables first, and see if this correlation might effect our model.

```{r}
model <- lm(Life.Expectancy ~ CO2.emissions + Health.expenditure + 
              ElectricPower + DrinkableWater + Beer + Obesity,
            data = LifeExp)
summary(model)
anova(model)
```

From our summary table, we see that we have an adjusted R-squared value of 0.7384. This means gives the 73% of life expectancy can be explained by our predictors. However, from before, we know that our model might be impacted by a Multicollinearity issue, where our predictor factors are highly correlated to each other. This can also be seen in our p-value difference, especially in CO2 emission, in our ANOVA vs linear model.

To further expand this point, we can calculate the variance inflation factors of the linear model, as seen here.

```{r}
vif(model)
```

A variance inflation higher than 5 is considered extremely high, while between 2\~5 can be considered as moderately correlated. There are no extremely high correlation between any of our variables, however, many variables are moderately correlated.

Let's also take a loot at the summary plots of our model and see if we can apply a transformation to adjust model.

```{r}
par(mfrow = c(2, 2)) 
plot(model)
```

From our QQ plot, it seems like a transformation could be done due to the normality of the errors. A good QQ plot should have all of its pointer in a straight line, while our QQ plot seems to have heavy tails on its end.

Perhaps the transformation will fix the Multicollinearity as well. Let's try to do a Inverse response plot to test for which kind of transformation is the best.

```{r}
inverseResponsePlot(model, key=TRUE)
```

Our lowest RSS value is at lambda = 1.36, meaning that we can apply the transformation of Y\^1.36.

```{r}
model2 <- lm(Life.Expectancy^(1.36) ~ CO2.emissions + Health.expenditure
             + ElectricPower + DrinkableWater + Beer + Obesity, data 
             = LifeExp)

par(mfrow = c(2, 2)) 
plot(model2)

summary(model2)
```

There doesn't seem to be too much changes in our model after the transformation, this makes sense since our values are only raised to the 1.36th power. It seems like more steps needs to be taken.

Let's remove variables that has a high correlation and high p-values for a reduced model. This will help with our Multicollinearity issues. We can try a step-wise reduction, with remove the predictor with the highest p-value first.

```{r}
model3 <- lm(Life.Expectancy^(1.36) ~  CO2.emissions + Health.expenditure + 
              ElectricPower + DrinkableWater + Obesity, data = LifeExp)
summary(model3)
vif(model3)
```

The issue with Multicollinearity still exists and there seems to be values with high p-values, let's try to remove the next predictor with highest p-value, the obesity rate.

```{r}
model4 <- lm(Life.Expectancy^(1.36) ~  CO2.emissions + Health.expenditure + 
              ElectricPower + DrinkableWater, data = LifeExp)
summary(model4)
vif(model4)
```

The issue with Multicollinearity still exists and there seems to be values with high p-values, let's try to remove the next predictor with highest p-value, the CO2 emission rate.

```{r}
model5 <- lm(Life.Expectancy^(1.36) ~ Health.expenditure + 
              ElectricPower + DrinkableWater, data = LifeExp)
summary(model5)
vif(model5)
```

Our reduced model has a R-squared value of 0.7434, which is higher than our original model. All of the predictors in our model also appears to be significant with a p-value less than 0.05. There are no Multicollinearity issues anymore between the predictor variables as their variance inflation are all less than 2. This appears to be a good model to predict our data.

## Results

From our modelling, it is suggested that our best model is model5. This model suggests that the most highly related factors to one's life expectancy in a country is their health expenditure, their electric power consumption, and the amount of people that is using basic water services. We can predict one's life expectancy from a country with the equation:

$Predicted.LifeExpectancy=1.469\times 10^2 + 3.658\times 10^1\times HealthExpenditure+\times 10^{-3}\times ElectricPower+1.849\times 10^1 \times DrinkableWater$

# Discussion

Overall, through our study, we find that a country is their health expenditure, their electric power consumption, and the amount of people that is using basic water services are the most influential to one's life expectancy.

This result makes sense in the context of our study, we know that filtered water is a very essential component to live a healthy life. Many studies had proved that good hydration is linked with longevity, this research conducted by National Heart, Lung, and Blood Institute had stated found that good hydration will reduce risks for heart failure: [https://www.nhlbi.nih.gov/news/2022/good-hydration-may-reduce-long-term-risks-heart-failure]

To continue, what our country can do for our physical health is definitely another very influential factor. With proper healthcare, vaccines, and annual checkups, we can prevent ourselves from certain diseases, or get treatment when it is still early. Lastly, the usage of electric powers allows one to live a better lifestyle, thus increasing one's life expectancy.

One limitation to our model is that we only has the chance to study the data from the year 2015. Many things would've changed in the world by now, especially after the global pandemic. If possible, it would be a good idea to further expand our study through out the past few years to get a better and more accurate prediction based on the recent data. 

Another limitation is that there are still many factors we can consider in our study that haven't been covered, such as smoking, diet on certain type of foods, physical activity level, etc. Many other factors can also significantly contribute to our life expectancy, and unfortunately many of which are not quantitative. We could collect new data by surveying people around the world to rate themselves on a scale of 1~10, but that is too big of a project on a personal level, and would have to be saved for another time.     

All in all, we should be appreciative of the advancements we have made in healthcare and other fields. It's crucial to remember that there are still many differences in life expectancy among countries. By making investments and donations in services like healthcare, water filters, and electric power systems, we can help to create a society where everyone has the chance to lead long and happy lives.


